server {
    listen 80;
    
    root /usr/share/nginx/html;
    index index.html;

    # Include default mime types to ensure JSON is served as application/json
    include /etc/nginx/mime.types;

    # Security headers for SharedArrayBuffer
    add_header 'Cross-Origin-Opener-Policy' 'same-origin';
    add_header 'Cross-Origin-Embedder-Policy' 'require-corp';
    add_header 'Cross-Origin-Resource-Policy' 'same-origin';

    location / {
        try_files $uri $uri/ /index.html;
    }

    # Ensure JSON files are definitely matching and served correctly
    location ~ \.json$ {
        add_header 'Cross-Origin-Opener-Policy' 'same-origin';
        add_header 'Cross-Origin-Embedder-Policy' 'require-corp';
        add_header 'Cross-Origin-Resource-Policy' 'same-origin';
        add_header 'Content-Type' 'application/json';
        add_header 'Cache-Control' 'no-cache';
        try_files $uri =404;
    }
}
